{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Easy Moss Global Schema",
    "type": "object",
    "properties": {
        "assignment_path": {
            "description": "The path to the zip file containing the assignment downloaded from Prarie Learn",
            "type": "string"
        },
        "global_comment": { "$ref": "#/$defs/comment" },
        "global_number_of_matches_to_show": { "$ref": "#/$defs/number_of_matches_to_show" },
        "global_language": { "$ref": "#/$defs/language" },
        "global_max_appearances": { "$ref": "#/$defs/max_appearances" },

        "assignment_info": {
            "type": "object",
            "properties": {
                "question_name": {
                    "description": "The name of the question in Prairie Learn",
                    "type": "string"
                },
                "question_path": {
                    "description": "The path to the zip file this question appears in",
                    "type": "string"
                },
                "nested_comment": { "$ref": "#/$defs/comment" },
                "nested_number_of_matches_to_show": { "$ref": "#/$defs/number_of_matches_to_show" },
                "nested_language": { "$ref": "#/$defs/language" },
                "nested_max_appearances": { "$ref": "#/$defs/max_appearances" },
                "submitted_files": {
                    "description": "A list of glob patterns matching the names of the files the students submitted",
                    "type": "array",
                    "items": {
                        "type": "string"
                      }
                },
                "base_files": {
                    "description": "List of one or more glob patterns specifying paths to files on this computer that contain base files. Base files are those that were provided to the student",
                    "type": "array",
                    "items": {
                        "type": "string"
                      }
                }
            }
        }
    },

    "allOf": [
        {
            "if": {
                "properties": {
                    "global_comment": { "$ref": "#/$defs/comment" }
                }
            },
            "then": {
                "required": [ "global_comment" ]
            },
            "else": {
                "properties": {
                    "nested_comment": { "$ref": "#/$defs/comment" }
                },
                "required": [ "nested_comment"]
            }
        },

        {
            "if": {
                "properties": {
                    "global_number_of_matches_to_show": { "$ref": "#/$defs/number_of_matches_to_show" }
                }
            },
            "then": {
                "required": [ "global_number_of_matches_to_show" ]
            },
            "else": {
                "properties": {
                    "nested_": { "$ref": "#/$defs/number_of_matches_to_show" }
                },
                "required": [ "nested_number_of_matches_to_show"]
            }
        },
    
        {
            "if": {
                "properties": {
                    "global_language": { "$ref": "#/$defs/language" }
                }
            },
            "then": {
                "required": [ "global_language" ]
            },
            "else": {
                "properties": {
                    "nested_language": { "$ref": "#/$defs/language" }
                },
                "required": [ "nested_language"]
            }
        },

        {
            "if": {
                "properties": {
                    "global_max_appearances": { "$ref": "#/$defs/max_appearances" }
                }
            },
            "then": {
                "required": [ "global_max_appearances" ]
            },
            "else": {
                "properties": {
                    "nested_max_appearances": { "$ref": "#/$defs/max_appearances" }
                },
                "required": [ "nested_max_appearances"]
            }
        }
    ],


    "$defs": {
        "comment": {
            "description": "A comment attached to this report generated by MOSS. Corresponds to MOSS -c option",
            "type": "string"
        },
        "number_of_matches_to_show": {
            "description": "The number of matches to show in the report generated",
            "type": "integer",
            "default": 250
        },
        "language": {
            "description": "The language the problem is in",
            "type": "string",
            "enum": ["c", "cc", "java", "ml", "pascal", "ada", "lisp", "scheme", "haskell", "fortran", "ascii", "vhdl", "perl", "matlab", "python", "mips", "prolog", "spice", "vb", "csharp", "modula2", "a8086", "javascript", "plsql", "verilog"]
        },
        "max_appearances": {
            "description": "The maximum number of times a code segment can appear before it is ignored. If a code segment appears many times it is likely to be the result of legitimate sharing",
            "type": "integer",
            "default": 10
        },
        "question_name": {
            "description": "The name of the question in Prairie Learn",
            "type": "string"
        },
        "question_path": {
            "description": "The path to the zip file this question appears in",
            "type": "string"
        }
    }
}